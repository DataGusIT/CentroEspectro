{% extends "core/admin/admin_base.html" %}

{% block title %}
{% if contato %}
Editar Contato - Painel Administrativo
{% else %}
Novo Contato - Painel Administrativo
{% endif %}
{% endblock %}

{% block header %}
{% if contato %}
Editar Contato {{ contato.nome }}
{% else %}
Novo Contato
{% endif %}
{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'admin_contatos' %}">Contatos</a></li>
<li class="breadcrumb-item active" aria-current="page">
    {% if contato %}Editar{% else %}Novo{% endif %}
</li>
{% endblock %}

{% block content %}
<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">
            {% if contato %}Editar{% else %}Novo{% endif %} Contato
        </h6>
    </div>
    <div class="card-body">
        <form method="post">
            {% csrf_token %}

            {% if form.non_field_errors %}
            <div class="alert alert-danger">
                {% for error in form.non_field_errors %}
                {{ error }}
                {% endfor %}
            </div>
            {% endif %}

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.nome.id_for_label }}" class="form-label">Nome</label>
                    {{ form.nome }}
                    {% if form.nome.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.nome.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="col-md-6 mb-3">
                    <label for="{{ form.tipo.id_for_label }}" class="form-label">Tipo</label>
                    {{ form.tipo }}
                    {% if form.tipo.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.tipo.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="mb-3">
                <label for="{{ form.descricao.id_for_label }}" class="form-label">Descrição</label>
                {{ form.descricao }}
                {% if form.descricao.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.descricao.errors %}
                    {{ error }}
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <div class="mb-3">
                <label for="{{ form.imagem_url.id_for_label }}" class="form-label">URL da Imagem</label>
                {{ form.imagem_url }}
                {% if form.imagem_url.errors %}
                <div class="invalid-feedback d-block">
                    {% for error in form.imagem_url.errors %}
                    {{ error }}
                    {% endfor %}
                </div>
                {% endif %}
                <div class="form-text">URL completa para uma imagem representativa deste contato</div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.cidade.id_for_label }}" class="form-label">Cidade</label>
                    {{ form.cidade }}
                    {% if form.cidade.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.cidade.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="col-md-6 mb-3">
                    <label for="{{ form.estado.id_for_label }}" class="form-label">Estado</label>
                    {{ form.estado }}
                    {% if form.estado.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.estado.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="{{ form.telefone.id_for_label }}" class="form-label">Telefone</label>
                    {{ form.telefone }}
                    {% if form.telefone.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.telefone.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="col-md-6 mb-3">
                    <label for="{{ form.horario_funcionamento.id_for_label }}" class="form-label">Horário de
                        Funcionamento</label>
                    {{ form.horario_funcionamento }}
                    {% if form.horario_funcionamento.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.horario_funcionamento.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div class="form-text">Exemplo: Segunda a Sexta, 8h às 18h</div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 mb-3">
                    <label for="{{ form.avaliacao.id_for_label }}" class="form-label">Avaliação</label>
                    <div class="input-group">
                        {{ form.avaliacao }}
                        <span class="input-group-text">
                            <div class="stars-container">
                                <i class="far fa-star star-icon" data-value="1"></i>
                                <i class="far fa-star star-icon" data-value="2"></i>
                                <i class="far fa-star star-icon" data-value="3"></i>
                                <i class="far fa-star star-icon" data-value="4"></i>
                                <i class="far fa-star star-icon" data-value="5"></i>
                            </div>
                        </span>
                    </div>
                    {% if form.avaliacao.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.avaliacao.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>

                <div class="col-md-4 mb-3">
                    <div class="form-check mt-4">
                        {{ form.atendimento_presencial }}
                        <label class="form-check-label" for="{{ form.atendimento_presencial.id_for_label }}">
                            Atendimento Presencial
                        </label>
                    </div>
                </div>

                <div class="col-md-4 mb-3">
                    <div class="form-check mt-4">
                        {{ form.atendimento_online }}
                        <label class="form-check-label" for="{{ form.atendimento_online.id_for_label }}">
                            Atendimento Online
                        </label>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-between mt-4">
                <a href="{% url 'admin_contatos' %}" class="btn btn-secondary">Cancelar</a>
                <button type="submit" class="btn btn-primary">Salvar</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .stars-container {
        display: flex;
        cursor: pointer;
    }

    .star-icon {
        color: #f8ac59;
        margin-right: 2px;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    $(document).ready(function () {
        // Função para atualizar as estrelas visuais
        function updateStars(rating) {
            $('.star-icon').removeClass('fas').addClass('far');

            // Determina quantas estrelas devem estar cheias
            let fullStars = Math.floor(rating);
            let hasHalfStar = (rating - fullStars) >= 0.5;

            // Preenche as estrelas inteiras
            for (let i = 0; i < fullStars; i++) {
                $(`.star-icon[data-value="${i + 1}"]`).removeClass('far').addClass('fas');
            }

            // Adiciona meia estrela se necessário
            if (hasHalfStar && fullStars < 5) {
                $(`.star-icon[data-value="${fullStars + 1}"]`).removeClass('far fas').addClass('fas fa-star-half-alt');
            }
        }

        // Inicializar as estrelas com base no valor atual
        updateStars(parseFloat($('#{{ form.avaliacao.id_for_label }}').val()) || 0);

        // Atualizar estrelas quando o valor mudar
        $('#{{ form.avaliacao.id_for_label }}').on('input', function () {
            updateStars(parseFloat($(this).val()) || 0);
        });

        // Clicar nas estrelas para definir o valor
        $('.star-icon').click(function () {
            const value = $(this).data('value');
            $('#{{ form.avaliacao.id_for_label }}').val(value).trigger('input');
        });
    });
</script>
{% endblock %}